const fs = require('fs')
const path = require('path')
const flattenDeep = require('lodash.flattendeep')

function processDir (file, pattern) {
  let result = []
  if (fs.lstatSync(file).isDirectory()) {
    fs.readdirSync(file).forEach(_file => {
      const current = processDir(path.join(file, _file), pattern)
      result.push(current)
    })
  } else if (fs.lstatSync(file).isFile()) {
    if (pattern) {
      if (pattern.test(path.extname(file))) {
        result.push(path.resolve(file))
      }
    } else {
      result.push(path.resolve(file))
    }
  }
  return flattenDeep(result)
}

module.exports = processDir
